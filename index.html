<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Price Jump Predictor & Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .input-group input[type="text"],
        .input-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input[type="text"]:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-label {
            display: block;
            padding: 12px;
            background: #f5f5f5;
            border: 2px dashed #667eea;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-label:hover {
            background: #e8eaf6;
            border-color: #764ba2;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 14px 28px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .chart-container {
            position: relative;
            height: 350px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .trend-summary {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .trend-increasing {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        .trend-stable {
            background: #fff3e0;
            color: #ef6c00;
            border: 2px solid #ff9800;
        }

        .trend-volatile {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }

        .visualizer {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .visualizer-step {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .stack-visual {
            display: flex;
            align-items: flex-end;
            gap: 5px;
            margin-top: 10px;
            min-height: 50px;
        }

        .stack-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: 600;
        }

        .highlight {
            background: #ffd54f;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            margin-bottom: 20px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .input-section,
            .results-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .button-group {
                flex-direction: column;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìà Stock Price Jump Predictor</h1>
            <p>Analyze stock price trends using Next Greater Element (NGE) Algorithm</p>
        </div>

        <!-- Input Section -->
        <div class="card">
            <h2>üìä Input Stock Prices</h2>
            <div class="info-box">
                <h3>How it works:</h3>
                <p>Enter daily stock prices to predict the next day when each price will be exceeded. The algorithm uses a stack-based approach to efficiently find the "next greater element" for each price point.</p>
            </div>
            <div class="input-section">
                <div class="input-group">
                    <label>Manual Input (comma-separated prices):</label>
                    <textarea id="manualInput" placeholder="e.g., 100, 80, 60, 70, 60, 75, 85"></textarea>
                </div>
                <div class="input-group">
                    <label>Or Upload CSV File:</label>
                    <div class="file-upload">
                        <input type="file" id="csvFile" accept=".csv">
                        <label for="csvFile" class="file-upload-label">
                            üìÅ Click to upload CSV file<br>
                            <small>Expected format: single column of prices</small>
                        </label>
                    </div>
                    <div id="fileName" style="margin-top: 10px; color: #667eea; font-weight: 600;"></div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn-primary" onclick="analyzePrices()">üîç Analyze Prices</button>
                <button class="btn-secondary" onclick="clearAll()">üóëÔ∏è Clear All</button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <!-- Trend Summary -->
            <div class="card">
                <h2>üìâ Market Trend Analysis</h2>
                <div id="trendSummary" class="trend-summary"></div>
            </div>

            <!-- Chart and Table -->
            <div class="results-grid">
                <div class="card">
                    <h2>üìà Price Visualization</h2>
                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h2>üìã Detailed Results</h2>
                    <div style="overflow-x: auto;">
                        <table id="resultsTable">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Price</th>
                                    <th>Next Jump Price</th>
                                    <th>Days Until Jump</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Algorithm Visualizer -->
            <div class="card">
                <h2>üîß Algorithm Visualizer (Stack Operations)</h2>
                <div class="info-box">
                    <h3>Understanding the Algorithm:</h3>
                    <p>The Next Greater Element algorithm uses a stack to efficiently track potential "jump" candidates. As we process each price, we pop elements from the stack that are smaller than the current price (they found their next greater element), and push the current index onto the stack.</p>
                </div>
                <div id="visualizer" class="visualizer"></div>
            </div>
        </div>
    </div>

    <script>
        let priceChart = null;
        let prices = [];
        let results = [];

        // File upload handler
        document.getElementById('csvFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = `Selected: ${file.name}`;
                Papa.parse(file, {
                    complete: function(result) {
                        // Extract prices from CSV (assumes single column or first column)
                        const extractedPrices = result.data
                            .map(row => parseFloat(row[0]))
                            .filter(val => !isNaN(val) && val > 0);
                        
                        document.getElementById('manualInput').value = extractedPrices.join(', ');
                    },
                    error: function(error) {
                        alert('Error parsing CSV: ' + error.message);
                    }
                });
            }
        });

        // Main analysis function
        function analyzePrices() {
            const input = document.getElementById('manualInput').value.trim();
            
            if (!input) {
                alert('Please enter stock prices or upload a CSV file!');
                return;
            }

            // Parse input
            prices = input.split(',').map(p => parseFloat(p.trim())).filter(p => !isNaN(p));
            
            if (prices.length < 2) {
                alert('Please enter at least 2 valid prices!');
                return;
            }

            // Calculate NGE using stack
            results = calculateNGE(prices);

            // Display results
            displayResults();
            displayChart();
            displayTrendSummary();
            visualizeAlgorithm(prices);

            // Show results section
            document.getElementById('resultsSection').classList.remove('hidden');
        }

        // Next Greater Element Algorithm Implementation
        function calculateNGE(prices) {
            const n = prices.length;
            const result = [];
            const stack = []; // Stack stores indices
            const visualSteps = []; // For visualization

            // Initialize result array
            for (let i = 0; i < n; i++) {
                result.push({
                    day: i + 1,
                    price: prices[i],
                    nextJumpPrice: null,
                    daysUntilJump: null
                });
            }

            // Process each price from right to left
            for (let i = n - 1; i >= 0; i--) {
                // Pop elements from stack that are <= current price
                while (stack.length > 0 && prices[stack[stack.length - 1]] <= prices[i]) {
                    stack.pop();
                }

                // If stack is not empty, top element is the next greater element
                if (stack.length > 0) {
                    const nextIdx = stack[stack.length - 1];
                    result[i].nextJumpPrice = prices[nextIdx];
                    result[i].daysUntilJump = nextIdx - i;
                }

                // Push current index to stack
                stack.push(i);
            }

            return result;
        }

        // Display results in table
        function displayResults() {
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = '';

            results.forEach(r => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>Day ${r.day}</td>
                    <td>$${r.price.toFixed(2)}</td>
                    <td>${r.nextJumpPrice ? '$' + r.nextJumpPrice.toFixed(2) : 'No jump found'}</td>
                    <td>${r.daysUntilJump ? r.daysUntilJump + ' day(s)' : '-'}</td>
                `;
            });
        }

        // Display price chart
        function displayChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // Destroy existing chart
            if (priceChart) {
                priceChart.destroy();
            }

            const labels = results.map(r => `Day ${r.day}`);
            const data = results.map(r => r.price);

            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Stock Price ($)',
                        data: data,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 8,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const idx = context.dataIndex;
                                    const result = results[idx];
                                    let label = `Price: $${result.price.toFixed(2)}`;
                                    if (result.nextJumpPrice) {
                                        label += `\nNext Jump: $${result.nextJumpPrice.toFixed(2)} (in ${result.daysUntilJump} day(s))`;
                                    } else {
                                        label += '\nNo future jump found';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Price ($)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Trading Days'
                            }
                        }
                    }
                }
            });
        }

        // Analyze and display trend summary
        function displayTrendSummary() {
            const summaryDiv = document.getElementById('trendSummary');
            
            // Calculate metrics
            let increases = 0;
            let decreases = 0;
            let noChange = 0;
            
            for (let i = 1; i < prices.length; i++) {
                if (prices[i] > prices[i-1]) increases++;
                else if (prices[i] < prices[i-1]) decreases++;
                else noChange++;
            }

            const total = prices.length - 1;
            const increasePercent = (increases / total) * 100;
            const decreasePercent = (decreases / total) * 100;

            // Count prices with no future jump
            const noJumpCount = results.filter(r => r.nextJumpPrice === null).length;
            
            let trendClass, trendText, trendIcon;
            
            if (increasePercent >= 60) {
                trendClass = 'trend-increasing';
                trendText = `üìà Mostly Increasing Trend`;
                trendIcon = '‚úÖ';
            } else if (Math.abs(increasePercent - decreasePercent) < 20) {
                trendClass = 'trend-stable';
                trendText = `üìä Stable/Sideways Market`;
                trendIcon = '‚öñÔ∏è';
            } else {
                trendClass = 'trend-volatile';
                trendText = `‚ö†Ô∏è Volatile Market`;
                trendIcon = 'üîÑ';
            }

            summaryDiv.className = `trend-summary ${trendClass}`;
            summaryDiv.innerHTML = `
                <div style="font-size: 1.5em; margin-bottom: 10px;">${trendIcon}</div>
                <div>${trendText}</div>
                <div style="font-size: 0.9em; margin-top: 15px; opacity: 0.9;">
                    Increases: ${increases} | Decreases: ${decreases} | No Future Jumps: ${noJumpCount}
                </div>
            `;
        }

        // Visualize algorithm step-by-step
        function visualizeAlgorithm(prices) {
            const visualizer = document.getElementById('visualizer');
            visualizer.innerHTML = '<h3 style="margin-bottom: 15px;">Step-by-Step Stack Operations:</h3>';

            const n = prices.length;
            const stack = [];
            let stepCount = 0;

            // Process from right to left
            for (let i = n - 1; i >= 0; i--) {
                stepCount++;
                
                // Create step container
                const stepDiv = document.createElement('div');
                stepDiv.className = 'visualizer-step';
                
                let operations = [];

                // Pop operations
                let poppedElements = [];
                while (stack.length > 0 && prices[stack[stack.length - 1]] <= prices[i]) {
                    poppedElements.push(stack.pop());
                }

                if (poppedElements.length > 0) {
                    operations.push(`üîª Popped ${poppedElements.length} element(s): Day ${poppedElements.map(idx => idx + 1).join(', ')}`);
                }

                // Check for next greater element
                let ngeText = '';
                if (stack.length > 0) {
                    const nextIdx = stack[stack.length - 1];
                    ngeText = `‚úÖ Found NGE for Day ${i + 1} ($${prices[i]}): Day ${nextIdx + 1} ($${prices[nextIdx]})`;
                } else {
                    ngeText = `‚ùå No NGE found for Day ${i + 1} ($${prices[i]})`;
                }

                // Push operation
                stack.push(i);
                operations.push(`üî∫ Pushed Day ${i + 1} onto stack`);

                // Build step HTML
                stepDiv.innerHTML = `
                    <strong>Step ${stepCount}: Processing Day ${i + 1} (Price: $${prices[i]})</strong>
                    <div style="margin-top: 8px;">
                        ${operations.map(op => `<div style="margin: 5px 0;">‚Ä¢ ${op}</div>`).join('')}
                        <div style="margin: 5px 0;">${ngeText}</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Current Stack:</strong>
                        <div class="stack-visual">
                            ${stack.map(idx => `<div class="stack-item">Day ${idx + 1}</div>`).reverse().join('')}
                            ${stack.length === 0 ? '<div style="color: #999;">Empty</div>' : ''}
                        </div>
                    </div>
                `;

                visualizer.appendChild(stepDiv);
            }
        }

        // Clear all inputs and results
        function clearAll() {
            document.getElementById('manualInput').value = '';
            document.getElementById('csvFile').value = '';
            document.getElementById('fileName').textContent = '';
            document.getElementById('resultsSection').classList.add('hidden');
            
            if (priceChart) {
                priceChart.destroy();
                priceChart = null;
            }

            prices = [];
            results = [];
        }
    </script>
</body>
</html>